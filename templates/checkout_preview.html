{% extends 'base.html' %}

{% block title %}Preview Receipt - Checkout{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  .receipt-header-icon { text-align: center; margin: 2.5rem 0 2rem 0; }
  .receipt-header-icon .fa-file-invoice-dollar { color: var(--primary-color); font-size: 3.5em; margin-bottom: 0.5rem; }
</style>
{% endblock %}

{% block content %}
<div class="container checkout-container">
  <div class="receipt-header-icon">
    <i class="fas fa-file-invoice-dollar"></i>
    <h1>Preview Receipt</h1>
    <p>Please review the details below before finalizing the checkout.</p>
  </div>
  <div class="receipt-content">
    <div class="receipt-container" style="max-width:480px;margin:auto;">
      <div class="header" style="text-align:center;margin-bottom:1.5rem;">
        <h1>{{ checkout_data.store_name }}</h1>
        <p>Thank you for your business!</p>
      </div>
      <div>
        <strong>Receipt ID:</strong> {{ checkout_data.receipt_id }}<br>
        <strong>Date:</strong> {{ checkout_data.receipt_date }}<br>
        <strong>Customer:</strong> {{ checkout_data.customer_name }}<br>
        {% if not is_deposit or checkout_data.pet_name != 'N/A' %}
        <strong>Pet:</strong> {{ checkout_data.pet_name }}<br>
        {% endif %}
        <strong>Employee:</strong> {{ checkout_data.employee_name }}<br>
      </div>
      <div class="line-items" style="margin-bottom:1.2rem;">
        <h3 style="margin-bottom:0.4em;">{% if is_deposit %}Deposit Information{% else %}Services & Products{% endif %}</h3>
        {% set items = checkout_data.line_items %}
        {% for item in items %}
        <div class="line-item" style="display:flex;justify-content:space-between;margin-bottom:0.4em;">
          <span>{{ item.name }}</span>
          <span>${{ '%.2f'|format(item.price|float) }}</span>
        </div>
        {% endfor %}
      </div>
      <div class="totals" style="margin-top:1.2rem;border-top:1px solid #eee;padding-top:0.7rem;">
        <div class="totals-row" style="display:flex;justify-content:space-between;margin-bottom:0.2em;font-size:1.06em;">
          <span>Subtotal:</span><span>${{ '%.2f'|format(checkout_data.subtotal|float) }}</span>
        </div>
        {% if not is_deposit %}
        <div class="totals-row" style="display:flex;justify-content:space-between;margin-bottom:0.2em;font-size:1.06em;">
          <span>Taxes:</span><span>${{ '%.2f'|format(checkout_data.taxes|float) }}</span>
        </div>
        <div class="totals-row" style="display:flex;justify-content:space-between;margin-bottom:0.2em;font-size:1.06em;">
          <span>Tip:</span><span>${{ '%.2f'|format(checkout_data.tip_amount|float) }}</span>
        </div>
        {% endif %}
        <div class="totals-row total" style="font-weight:bold;color:#5c4d7d;font-size:1.13em;display:flex;justify-content:space-between;">
          <span>Total:</span><span>${{ '%.2f'|format(checkout_data.total|float) }}</span>
        </div>
      </div>
      </div>
      <div class="footer" style="text-align:center;color:#888;font-size:0.97em;margin-top:2rem;">
        Receipt generated by Pawfection<br>
        <p>{{ checkout_data.receipt_id }}</p>
        {% if is_deposit %}
        <p><strong>Payment Type:</strong> Deposit</p>
        {% endif %}
        <p><strong>Payment Method:</strong> {{ checkout_data.payment_method|capitalize }}</p>
      </div>
      <form method="POST" action="{{ url_for('appointments.finalize_checkout', appointment_id=appointment_id) }}">
        <button type="submit" class="button button-success" style="width:100%;margin:1.4rem 0 0.6rem 0;font-size:1.13em;background:#28a745;">{% if is_deposit %}Process Deposit{% else %}Complete Checkout{% endif %}</button>
      </form>

      <div style="text-align:center; margin-top:1rem;">
          <a href="{{ url_for('dashboard') }}" class="button button-secondary" style="width:100%; display:inline-block; box-sizing: border-box;" onclick="return confirm('Are you sure you want to cancel? Progress will be lost.')">Cancel Checkout</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
