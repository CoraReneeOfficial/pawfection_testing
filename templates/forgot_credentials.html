{% extends 'base.html' %}

{% block title %}Recover Account - Pawfection Grooming Solutions{% endblock %}

{% block head %}
<style>
    .legal-links-footer {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color-light);
        font-size: 0.9rem;
    }
    .legal-links-footer a {
        color: var(--text-muted);
        text-decoration: none;
        margin: 0 0.75rem;
    }
    .legal-links-footer a:hover {
        color: var(--primary-color);
        text-decoration: underline;
    }
    
    /* Fix for buttons overflowing their containers */
    .form-button-wrapper {
        padding: 0;
        margin: 0;
        width: 100%;
    }
    
    .recovery-button {
        box-sizing: border-box;
        display: inline-block;
        width: 100% !important;
        margin-bottom: 0.75rem;
        max-width: 100%;
        overflow: hidden;
    }
    
    .form-button-wrapper a.button,
    .form-button-wrapper button.button {
        width: 100% !important;
        margin: 0 0 0.5rem 0;
        box-sizing: border-box;
    }
</style>
{% endblock %}

{% block content %}
<div style="min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <div class="logo-image-login" style="display: flex; justify-content: center; align-items: center; width: 100%;">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Pawfection Grooming Solutions Logo" style="max-width: 100%; width: 350px; margin-bottom: 1rem; display: block;">
    </div>
    <div class="form-wrapper">
        <div class="form-container form-container-sm">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <h1 class="form-title">Account Recovery</h1>
                <h2 class="form-title">{{ recovery_type|capitalize }}</h2>
            </div>
            
            {% if recovery_type == 'select' %}
            <div class="form-group" style="text-align: center; margin-bottom: 2rem;">
                <p>Select what you need help with:</p>
            </div>
            <div class="form-button-wrapper">
                <a href="{{ url_for('auth.forgot_credentials', recovery_type='username', account_type=account_type) }}" class="button button-primary recovery-button">
                    Forgot Username
                </a>
                <a href="{{ url_for('auth.forgot_credentials', recovery_type='password', account_type=account_type) }}" class="button button-primary recovery-button">
                    Forgot Password
                </a>
            </div>
            {% endif %}
            
            {% if recovery_type == 'username' %}
            <form method="POST" action="{{ url_for('auth.forgot_credentials', recovery_type='username', account_type=account_type) }}" novalidate>
                <div class="form-group">
                    {% if account_type == 'store' %}
                    <p>To retrieve your store username, please enter your store email address:</p>
                    <label for="email">Store Email</label>
                    <input type="email" id="email" name="email" required class="form-input" autofocus value="{{ request.form.email or '' }}">
                    {% else %}
                    <p>To retrieve your username, please enter your email address:</p>
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required class="form-input" autofocus value="{{ request.form.email or '' }}">
                    {% endif %}
                </div>
                <div class="form-button-wrapper">
                    <button type="submit" class="button button-primary">
                        Find Username
                    </button>
                </div>
            </form>
            {% endif %}
            
            {% if recovery_type == 'password' %}
            <form method="POST" action="{{ url_for('auth.forgot_credentials', recovery_type='password', account_type=account_type) }}" novalidate>
                <div class="form-group">
                    <p>To reset your password, enter your username:</p>
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required class="form-input" autofocus value="{{ request.form.username or '' }}">
                </div>
                <div class="form-button-wrapper">
                    <button type="submit" class="button button-primary">
                        Continue
                    </button>
                </div>
            </form>
            {% endif %}
            
            {% if recovery_type == 'security_question' %}
            <form method="POST" action="{{ url_for('auth.verify_security_answer', account_type=account_type) }}" novalidate>
                <input type="hidden" name="username" value="{{ username }}">
                <div class="form-group">
                    <p>Please answer your security question:</p>
                    <label for="security_question">Security Question</label>
                    <input type="text" id="security_question" value="{{ security_question }}" readonly class="form-input">
                    <label for="security_answer">Your Answer</label>
                    <input type="text" id="security_answer" name="security_answer" required class="form-input" autofocus>
                </div>
                <div class="form-button-wrapper">
                    <button type="submit" class="button button-primary">
                        Verify Answer
                    </button>
                </div>
            </form>
            {% endif %}
            
            {% if recovery_type == 'reset_password' %}
            <form method="POST" action="{{ url_for('auth.reset_password', account_type=account_type) }}" novalidate>
                <input type="hidden" name="username" value="{{ username }}">
                <input type="hidden" name="token" value="{{ token }}">
                <div class="form-group">
                    <label for="new_password">New Password</label>
                    <input type="password" id="new_password" name="new_password" required class="form-input" autofocus>
                </div>
                <div class="form-group">
                    <label for="confirm_password">Confirm Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required class="form-input">
                </div>
                <div class="form-button-wrapper">
                    <button type="submit" class="button button-primary">
                        Reset Password
                    </button>
                </div>
            </form>
            {% endif %}
            
            <div class="form-button-wrapper" style="margin-top: 1.5rem; text-align: center;">
                {% if account_type == 'user' %}
                <a href="{{ url_for('auth.login') }}" class="button button-secondary recovery-button">Back to Login</a>
                {% elif account_type == 'store' %}
                <a href="{{ url_for('store_login') }}" class="button button-secondary recovery-button">Back to Store Login</a>
                {% elif account_type == 'superadmin' %}
                <a href="{{ url_for('superadmin_login') }}" class="button button-secondary recovery-button">Back to Superadmin Login</a>
                {% endif %}
            </div>
            
            <div class="legal-links-footer">
                <a href="{{ url_for('view_user_agreement') }}">User Agreement</a> |
                <a href="{{ url_for('view_privacy_policy') }}">Privacy Policy</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
