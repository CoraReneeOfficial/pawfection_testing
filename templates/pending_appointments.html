 {% extends 'base.html' %}

{% block title %}Pending Appointment Requests{% endblock %}

{% block content %}
<div class="main-content container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h1 class="store-title">Pending Appointment Requests</h1>
            {% if public_page_url %}
            <p class="store-description" style="font-size: 1rem; color: var(--secondary-dark); margin-bottom: 0;">
                Customer-facing page: <a href="{{ public_page_url }}" target="_blank">{{ public_page_url }}</a>
            </p>
            {% endif %}
        </div>
        <div>
            <span style="display: inline-flex; align-items: center; padding: 0.4em 1em; border-radius: 999px; font-size: 1rem; font-weight: 500; background: var(--info-light); color: var(--info-text); border: 1px solid var(--info-border);">
                {{ requests|length }} Pending
            </span>
        </div>
    </div>

    {% if requests %}
    <div class="content-card" style="overflow-x: auto;">
        <table class="appointments-table" style="width: 100%; border-collapse: collapse; min-width: 900px;">
            <thead>
                <tr>
                    <th class="appt-th">Submitted</th>
                    <th class="appt-th">Customer</th>
                    <th class="appt-th">Phone</th>
                    <th class="appt-th">Dog</th>
                    <th class="appt-th">Preferred Time</th>
                    <th class="appt-th">Notes</th>
                    <th class="appt-th" style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for r in requests %}
                <tr class="appt-tr">
                    <td class="appt-td">
                        <div style="font-weight: 500;">{{ r.created_at.strftime('%b %d, %Y') }}</div>
                        <div style="color: var(--text-muted); font-size: 0.9em;">{{ r.created_at.strftime('%I:%M %p') }}</div>
                    </td>
                    <td class="appt-td">{{ r.customer_name }}</td>
                    <td class="appt-td"><a href="tel:{{ r.phone }}">{{ r.phone }}</a></td>
                    <td class="appt-td">{{ r.dog_name }}</td>
                    <td class="appt-td">
                        {% if r.preferred_datetime is string %}
                            {{ r.preferred_datetime }}
                        {% else %}
                            <div>{{ r.preferred_datetime.strftime('%b %d, %Y') }}</div>
                            <div style="color: var(--text-muted); font-size: 0.9em;">{{ r.preferred_datetime.strftime('%I:%M %p') }}</div>
                        {% endif %}
                    </td>
                    <td class="appt-td" style="max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ r.notes }}">{{ r.notes or 'No notes' }}</td>
                    <td class="appt-td" style="text-align: right;">
                        <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <a href="{{ url_for('management.edit_appointment_request', req_id=r.id) }}" class="button" style="padding: 0.3em 0.9em; font-size: 0.95em; background: var(--primary-light); color: var(--primary-color); border: 1px solid var(--primary-border);">Edit</a>
                            <form action="{{ url_for('management.approve_appointment_request', req_id=r.id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="button button-primary" style="padding: 0.3em 0.9em; font-size: 0.95em;">Approve</button>
                            </form>
                            <form action="{{ url_for('management.reject_appointment_request', req_id=r.id) }}" method="POST" style="display: inline;">
                                <button type="submit" class="button" style="padding: 0.3em 0.9em; font-size: 0.95em; background: var(--danger-light); color: var(--danger-color); border: 1px solid var(--danger-border);">Reject</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="content-card" style="text-align: center; padding: 3em 1em;">
        <svg style="margin: 0 auto 1em auto; display: block; color: var(--secondary-color);" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
        <h3 style="margin-top: 0.5em; font-size: 1.3em; color: var(--primary-color);">No pending requests</h3>
        <p style="margin-top: 0.5em; color: var(--text-muted);">All caught up! Check back later for new appointment requests.</p>
    </div>
    {% endif %}
</div>

<style>
.appointments-table {
  border-collapse: collapse;
  width: 100%;
  background: var(--white);
}
.appointments-table th, .appointments-table td {
  border-right: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
  padding: 0.9em 1.1em;
  font-size: 1rem;
  text-align: left;
}
.appointments-table th:last-child, .appointments-table td:last-child {
  border-right: none;
}
.appointments-table th {
  background: var(--primary-lighter);
  color: var(--primary-color);
  font-weight: 600;
  font-size: 1em;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.appointments-table tr:nth-child(even) td {
  background: var(--secondary-light);
}
.appointments-table tr:hover td {
  background: var(--primary-light);
}
.appointments-table td {
  color: var(--text-dark);
}
</style>
{% endblock %}
